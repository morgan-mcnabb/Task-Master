import{I as J,m as f,i as O,c as m,d as I,b as c,t as h,q as D,J as Q,K as W,L as X,r as b,p as Y,G as F,w as V,o as Z,M as q,e as ee,v as te,F as _,x as $,f as ne,g as ae,H as le}from"./index-CTgWvdHK.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"flex items-start justify-between gap-3"},re={key:0,class:"text-sm font-semibold"},ie={class:"mt-1 text-sm"},ue={key:1,class:"mt-2 flex items-center gap-2"},ce={class:"rounded bg-white/50 px-1.5 py-0.5 text-xs"},de={__name:"Toast",props:{title:{type:String,default:""},message:{type:String,default:""},correlationId:{type:String,default:""},variant:{type:String,default:"error"},show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:o}){const i=n,y=o;function p(){if(i.correlationId)try{navigator.clipboard.writeText(i.correlationId)}catch{}}return(u,l)=>(f(),J(Q,{name:"fade"},{default:O(()=>[n.show?(f(),m("div",{key:0,class:D(["fixed right-4 top-4 z-50 w-[28rem] max-w-[90vw] rounded-lg border p-4 shadow-lg",{"bg-red-50 border-red-200 text-red-800":n.variant==="error","bg-blue-50 border-blue-200 text-blue-800":n.variant==="info","bg-green-50 border-green-200 text-green-800":n.variant==="success"}]),role:"alert"},[c("div",se,[c("div",null,[n.title?(f(),m("div",re,h(n.title),1)):I("",!0),c("div",ie,h(n.message),1),n.correlationId?(f(),m("div",ue,[l[1]||(l[1]=c("span",{class:"text-xs opacity-80"},"Correlation ID:",-1)),c("code",ce,h(n.correlationId),1),c("button",{class:"text-xs underline",onClick:p},"Copy")])):I("",!0)]),c("button",{class:"text-sm underline opacity-70 hover:opacity-100",onClick:l[0]||(l[0]=r=>y("close"))}," Dismiss ")])],2)):I("",!0)]),_:1}))}},Le=oe(de,[["__scopeId","data-v-4209b5bb"]]);function fe(n,o=300,i={}){const{leading:y=!1,trailing:p=!0}=i;let u=null,l=null,r=null,s=!1;const x=()=>{const d=l,w=r;l=r=null,n.apply(w,d)};function g(...d){l=d,r=this,u&&clearTimeout(u),y&&!s&&(s=!0,n.apply(r,l),l=r=null),u=setTimeout(()=>{u=null,s=!1,p&&l&&x()},o)}return g.cancel=()=>{u&&clearTimeout(u),u=null,l=r=null,s=!1},g.flush=()=>{u&&(clearTimeout(u),u=null,p&&l&&x(),s=!1)},g}function ge(n){let o=null;function i(...u){o&&o.abort(),o=new AbortController;const l=o.signal;return{promise:Promise.resolve().then(()=>n({signal:l},...u)).finally(()=>{o&&o.signal===l&&(o=null)}),signal:l}}function y(){o&&(o.abort(),o=null)}function p(){return o?o.signal:null}return{run:i,abort:y,getSignal:p}}function me(){const n=W(X,null);if(!n)throw new Error("API client was not provided. Ensure main.js provides ApiClientKey.");return n}const ve={class:"flex flex-wrap items-start gap-2"},pe={class:"relative w-56 flex-shrink-0"},be=["placeholder","disabled"],ye={key:0,class:"absolute z-10 mt-1 max-h-48 w-56 overflow-auto rounded-md border border-gray-200 bg-white shadow",role:"listbox"},he={key:0,class:"px-3 py-2 text-sm text-gray-500"},xe={key:1,class:"px-3 py-2 text-sm text-red-600"},we=["onMousedown"],ke={class:"flex min-w-0 flex-1 flex-wrap items-center gap-2"},Ce=["disabled","title"],Te={class:"truncate max-w-[12rem]"},Ie=["disabled","onClick"],Me={__name:"TagPicker",props:{modelValue:{type:Array,default:()=>[]},placeholder:{type:String,default:"Add tag…"},limit:{type:Number,default:10},debounceMs:{type:Number,default:250},disabled:{type:Boolean,default:!1},fetcher:{type:Function,default:null},showClearButton:{type:Boolean,default:!0},clearButtonLabel:{type:String,default:"Clear"}},emits:["update:modelValue"],setup(n,{emit:o}){const i=n,y=o,p=me(),u=b(null),l=b(null),r=b(""),s=b([]),x=b(!1),g=b(!1),d=b(-1),w=b(""),k=Y(()=>F(i.modelValue));function A(e){const t=F(e);y("update:modelValue",t)}function B(e){const t=String(e).trim().toLowerCase();return k.value.some(a=>a.toLowerCase()===t)}function L(e){const t=String(e||"").trim();if(t){if(B(t)){r.value="",v();return}A([...k.value,t]),r.value="",v()}}function E(e){const t=k.value.filter(a=>a.toLowerCase()!==String(e).toLowerCase());A(t)}function z(){if(!i.disabled&&k.value.length!==0){A([]),r.value="",v();try{l.value?.focus()}catch{}}}function R(){s.value.length>0&&(g.value=!0)}function v(){g.value=!1,d.value=-1}function P(e){if(i.disabled)return;const t=e.key;if(t==="Enter"||t==="Tab"||t===","){if(d.value>=0&&d.value<s.value.length){e.preventDefault(),L(s.value[d.value]);return}const a=r.value;if(a){e.preventDefault(),L(a);return}}if(t==="ArrowDown"){if(!g.value){R();return}e.preventDefault();const a=Math.min(s.value.length-1,d.value+1);d.value=a;return}if(t==="ArrowUp"){if(!g.value)return;e.preventDefault();const a=Math.max(-1,d.value-1);d.value=a;return}t==="Escape"&&g.value&&(e.preventDefault(),v())}function K(e){L(e)}function N(){s.value.length&&(g.value=!0)}async function U(e,t,a){const T=encodeURIComponent(e),S=encodeURIComponent(String(t)),{data:C}=await p.get(`/api/v1/tags?search=${T}&limit=${S}`,{signal:a}),H=Array.isArray(C?.items)?C.items:Array.isArray(C)?C:[];return le(H)}const j=ge(async({signal:e},t)=>{x.value=!0,w.value="";try{const S=(await(typeof i.fetcher=="function"?i.fetcher:U)(t,i.limit,e)).filter(C=>!B(C));s.value=S.slice(0,i.limit),r.value.trim().length>0&&s.value.length>0?g.value=!0:v()}catch(a){a?.name!=="AbortError"&&(w.value=a?.message??"Failed to load suggestions.",v())}finally{x.value=!1}}),G=fe(e=>{if(!e||!e.trim()){s.value=[],v();return}j.run(e.trim())},i.debounceMs);V(r,e=>{d.value=-1,G(e)}),V(()=>i.modelValue,()=>{s.value=s.value.filter(e=>!B(e)),s.value.length===0&&v()});function M(e){const t=u.value;t&&e&&t!==e.target&&!t.contains(e.target)&&v()}return Z(()=>{window.addEventListener("click",M,{capture:!0})}),q(()=>{window.removeEventListener("click",M,{capture:!0})}),(e,t)=>(f(),m("div",{ref_key:"rootRef",ref:u,class:"w-full"},[c("div",ve,[c("div",pe,[ee(c("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),type:"text",placeholder:n.placeholder,disabled:n.disabled,class:"w-56 rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 disabled:opacity-60",onKeydown:P,onFocus:N},null,40,be),[[te,r.value]]),g.value?(f(),m("div",ye,[x.value?(f(),m("div",he,"Loading…")):w.value?(f(),m("div",xe,h(w.value),1)):(f(!0),m(_,{key:2},$(s.value,(a,T)=>(f(),m("button",{key:a,type:"button",class:D(["block w-full cursor-pointer px-3 py-1.5 text-left text-sm hover:bg-gray-50",{"bg-gray-100":T===d.value}]),role:"option",onMousedown:ne(S=>K(a),["prevent"])},h(a),43,we))),128))])):I("",!0)]),c("div",ke,[n.showClearButton&&k.value.length>0?(f(),m("button",{key:0,type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 disabled:opacity-50",disabled:n.disabled,onClick:z,"aria-label":"Clear tags",title:n.clearButtonLabel},[t[1]||(t[1]=ae(" ✕ ",-1)),c("span",null,h(n.clearButtonLabel),1)],8,Ce)):I("",!0),(f(!0),m(_,null,$(k.value,a=>(f(),m("div",{key:a,class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1 text-sm text-indigo-700"},[c("span",Te,h(a),1),c("button",{type:"button",class:"opacity-70 hover:opacity-100",title:"Remove",disabled:n.disabled,onClick:T=>E(a)},"✕",8,Ie)]))),128))])]),t[2]||(t[2]=c("div",{class:"mt-1 text-xs text-gray-500"}," Press Enter, comma, or Tab to add a tag. Suggestions update as you type. ",-1))],512))}};export{Le as T,Me as _,fe as d,ge as m,me as u};
