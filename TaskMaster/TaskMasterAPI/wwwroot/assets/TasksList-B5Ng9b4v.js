import{n as x,p as u,c as l,o as d,t as _,g as S,q as w,h as M,a as n,s as E,k as T,l as B,v as L,m as A,u as g,b as F,F as N,x as D,_ as V,y as $}from"./index-Ct3dq3h5.js";const p=x("taskCache",{state:()=>({etagById:new Map}),actions:{setETag(e,t){!e||!t||this.etagById.set(String(e),String(t))},getETag(e){return e?this.etagById.get(String(e))??null:null},clearETag(e){e&&this.etagById.delete(String(e))},reset(){this.etagById.clear()}}});function h(e){return{id:e.id,title:e.title,isCompleted:String(e.status).toLowerCase()==="done",_raw:e}}function I(e){return e?"Done":"Todo"}const U=x("tasks",{state:()=>({tasks:[],isLoading:!1,errorMessage:""}),getters:{hasTasks(e){return e.tasks.length>0},completedCount(e){return e.tasks.filter(t=>t.isCompleted).length},activeCount(e){return e.tasks.filter(t=>!t.isCompleted).length}},actions:{async fetchTasks(){const e=u(this),t=p();this.isLoading=!0,this.errorMessage="";try{const{data:a}=await e.get("/api/v1/tasks"),s=Array.isArray(a?.items)?a.items:[];this.tasks=s.map(h);for(const i of s)i?.id&&i?.eTag&&t.setETag(String(i.id),i.eTag)}catch(a){this.errorMessage=a?.message??"Failed to load tasks."}finally{this.isLoading=!1}},async createTask(e){const t=u(this),a=p();if(!(!e||!e.trim())){this.errorMessage="";try{const{data:s}=await t.post("/api/v1/tasks",{title:e.trim(),priority:"Medium"}),i=h(s);this.tasks.unshift(i),s?.eTag&&s?.id&&a.setETag(String(s.id),s.eTag)}catch(s){throw this.errorMessage=s?.message??"Failed to create task.",s}}},async toggleTask(e){const t=u(this),a=p(),s=this.tasks.find(r=>String(r.id)===String(e));if(!s)return;const i=!s.isCompleted,c=s.isCompleted;s.isCompleted=i;try{const r=a.getETag(String(e)),o=t.withIfMatch({},r),m={status:I(i)},{data:f,response:b}=await t.patch(`/api/v1/tasks/${encodeURIComponent(e)}`,m,{headers:o}),v=h(f),y=this.tasks.findIndex(C=>String(C.id)===String(e));y>=0&&(this.tasks[y]=v);const k=f?.eTag||t.readETag(b);k&&a.setETag(String(e),k)}catch(r){throw s.isCompleted=c,this.errorMessage=r?.message??"Failed to update task.",r}}}}),q={class:"rounded-md border border-red-200 bg-red-50 px-4 py-3 text-red-700"},P={__name:"ErrorMessage",props:{message:{type:String,required:!0}},setup(e){return(t,a)=>(d(),l("div",q,_(e.message),1))}},j={class:"mx-auto max-w-3xl p-6 space-y-8"},z=["disabled"],R={key:1,class:"py-16"},G={key:2,class:"divide-y divide-gray-200 rounded-md border border-gray-200 bg-white"},H={class:"flex items-center gap-3"},J=["checked","onChange"],K={key:0,class:"p-6 text-center text-gray-500"},Q={__name:"TasksList",setup(e){const t=U(),a=S(""),s=w(()=>[...t.tasks].sort((c,r)=>Number(c.isCompleted)-Number(r.isCompleted)));async function i(){const c=a.value.trim();c&&(await t.createTask(c),a.value="")}return M(()=>{t.hasTasks||t.fetchTasks()}),(c,r)=>(d(),l("section",j,[r[1]||(r[1]=n("header",{class:"space-y-2"},[n("h1",{class:"text-3xl font-semibold tracking-tight"},"Tasks"),n("p",{class:"text-gray-600"},"Vue + Pinia + DI-powered API client")],-1)),n("form",{onSubmit:A(i,["prevent"]),class:"flex items-center gap-3"},[B(n("input",{"onUpdate:modelValue":r[0]||(r[0]=o=>a.value=o),type:"text",placeholder:"Add a new taskâ€¦",class:"flex-1 rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},null,512),[[L,a.value]]),n("button",{type:"submit",class:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:!a.value.trim()}," Add ",8,z)],32),g(t).errorMessage?(d(),E(P,{key:0,message:g(t).errorMessage},null,8,["message"])):T("",!0),g(t).isLoading?(d(),l("div",R,[F(V,{label:"Loading tasks..."})])):(d(),l("ul",G,[(d(!0),l(N,null,D(s.value,o=>(d(),l("li",{key:o.id,class:"flex items-center justify-between gap-4 px-4 py-3"},[n("label",H,[n("input",{type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600",checked:o.isCompleted,onChange:m=>g(t).toggleTask(o.id)},null,40,J),n("span",{class:$(o.isCompleted?"line-through text-gray-400":"")},_(o.title),3)])]))),128)),g(t).hasTasks?T("",!0):(d(),l("li",K," No tasks yet. Add your first one above. "))]))]))}};export{Q as default};
