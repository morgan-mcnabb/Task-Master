import{n as W,r as A,w as P,p as w,c as n,m as i,b as s,e as x,d as I,q as U,j as l,s as N,F as y,x as b,t as d,T as G,D as R,S as H,y as le,k as ue,h as k,i as D,g as m,v as q,z as de,l as ge,a as ce,R as L,A as M,B as pe,C as me,P as ye}from"./index-CTgWvdHK.js";import{d as be,_ as ve,T as fe,m as xe}from"./TagPicker-Bqnf6D6L.js";import{g as he,a as Se}from"./statusStyles-Cs-sMj5i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Oe={class:"inline-flex items-center gap-2"},_e=["disabled"],ke=["value"],Ce={key:0,class:"h-4 w-4 animate-spin text-gray-600",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},Ae={key:1,class:"text-[11px] text-red-700"},Ne={__name:"TaskStatusInline",props:{taskId:{type:[String,Number],required:!0},status:{type:String,required:!0},disabled:{type:Boolean,default:!1}},setup(t){const r=t,g=W(),c=A(String(r.status)),o=A(!1),h=A("");P(()=>r.status,v=>{c.value=String(v)});const T=w(()=>r.disabled||o.value),C=w(()=>he(c.value));async function p(){const v=String(c.value);if(v!==r.status){o.value=!0,h.value="";try{await g.updateTaskStatus(r.taskId,v)}catch(f){c.value=String(r.status),h.value=f?.message??"Failed to update status."}finally{o.value=!1}}}return(v,f)=>(i(),n("div",Oe,[s("span",{"aria-hidden":"true",class:U(["h-2.5 w-2.5 rounded-full",l(Se)(c.value)])},null,2),x(s("select",{"onUpdate:modelValue":f[0]||(f[0]=S=>c.value=S),class:U(["rounded-md border pl-2 pr-8 py-1 text-xs focus:outline-none focus:ring-1 disabled:opacity-50",C.value]),disabled:T.value,onChange:p,"aria-label":"Change status"},[(i(!0),n(y,null,b(l(G),S=>(i(),n("option",{key:S,value:S},d(S),9,ke))),128))],42,_e),[[N,c.value]]),o.value?(i(),n("svg",Ce,[...f[1]||(f[1]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"},null,-1)])])):I("",!0),h.value?(i(),n("span",Ae,d(h.value),1)):I("",!0)]))}};function B(t){return t==null?[]:Array.isArray(t)?t:[t]}function $(t,r){const g=Number(t);return Number.isFinite(g)&&g>0?g:r}function j(t,r,g){return!t||typeof t!="string"?g:r.includes(t)?t:g}function K(t){return typeof t!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(t)?"":t}function J(t){return{pageNumber:$(t.pageNumber,R.pageNumber),pageSize:$(t.pageSize,R.pageSize),statuses:B(t.statuses),priorities:B(t.priorities),tags:B(t.tags),dueOnOrAfter:K(t.dueOnOrAfter),dueOnOrBefore:K(t.dueOnOrBefore),search:typeof t.search=="string"?t.search:"",sortBy:j(t.sortBy,le,"dueDate"),sortDirection:j(t.sortDirection,H,"asc")}}function we(t){const r={pageNumber:String(t.pageNumber),pageSize:String(t.pageSize),sortBy:t.sortBy,sortDirection:t.sortDirection};return t.search&&(r.search=t.search),t.dueOnOrAfter&&(r.dueOnOrAfter=t.dueOnOrAfter),t.dueOnOrBefore&&(r.dueOnOrBefore=t.dueOnOrBefore),Array.isArray(t.statuses)&&t.statuses.length>0&&(r.statuses=t.statuses),Array.isArray(t.priorities)&&t.priorities.length>0&&(r.priorities=t.priorities),Array.isArray(t.tags)&&t.tags.length>0&&(r.tags=t.tags),r}function Te(t){const r={pageNumber:t.pageNumber,pageSize:t.pageSize,includeTags:!0,sortBy:t.sortBy,sortDirection:t.sortDirection};return t.search&&(r.search=t.search),t.dueOnOrAfter&&(r.dueOnOrAfter=t.dueOnOrAfter),t.dueOnOrBefore&&(r.dueOnOrBefore=t.dueOnOrBefore),t.statuses?.length&&(r.statuses=t.statuses),t.priorities?.length&&(r.priorities=t.priorities),t.tags?.length&&(r.tags=t.tags),r}const De={class:"mx-auto max-w-6xl p-6 space-y-6"},Be={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Pe={class:"grid gap-3 rounded-lg border border-gray-200 bg-white p-4 shadow-sm md:grid-cols-3 lg:grid-cols-4"},Ie={class:"md:col-span-1 lg:col-span-2"},Re=["value"],Fe={class:"md:col-span-1"},Ve={class:"mt-2 space-y-2"},ze=["value"],Ee={class:"md:col-span-1"},Ue={class:"mt-2 space-y-2"},qe=["value"],Le={class:"md:col-span-1"},Me={class:"md:col-span-1"},$e={class:"md:col-span-3 lg:col-span-4"},je={class:"mt-1"},Ke={class:"md:col-span-1"},Je=["value"],We={class:"md:col-span-1"},Ge=["value"],He={class:"md:col-span-1"},Ze=["value"],Xe={key:0,class:"space-y-3 rounded-lg border border-gray-200 bg-white p-4"},Ye={class:"space-y-2"},Qe={key:0,class:"h-1 w-full animate-pulse rounded bg-indigo-200"},et={key:1,class:"rounded-lg border border-gray-200 bg-white p-8 text-center text-gray-600"},tt={key:0},st={key:1},rt=["aria-busy"],at={class:"divide-y"},ot={class:"col-span-5"},nt={class:"col-span-2"},it={class:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},lt={class:"col-span-2"},ut={class:"col-span-2 text-sm text-gray-700"},dt={class:"col-span-1 flex flex-wrap items-center gap-1"},gt={class:"mt-4 flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between"},ct={class:"text-sm text-gray-600"},pt={class:"font-medium"},mt={class:"flex items-center gap-3"},yt=["disabled"],bt={class:"px-2 text-sm text-gray-700"},vt=["disabled"],Ot={__name:"TasksList",setup(t){const r=W(),g=ue(),c=ce(),o=A(J(g.query));function h(u){const e=JSON.parse(JSON.stringify(u??{}));return Array.isArray(e.statuses)&&(e.statuses=[...e.statuses].sort()),Array.isArray(e.priorities)&&(e.priorities=[...e.priorities].sort()),Array.isArray(e.tags)&&(e.tags=[...e.tags].sort()),e}function T(u,e){return JSON.stringify(h(u))===JSON.stringify(h(e))}async function C({usePush:u=!1}={}){o.value.pageNumber<1&&(o.value.pageNumber=1);const e=we(o.value),O=g.query;if(!T(e,O))return u?c.push({query:e}):c.replace({query:e})}function p(u={usePush:!1}){return o.value.pageNumber=R.pageNumber,C(u)}function v(u){if(o.value[u])return o.value[u]=[],p()}const f=xe(async({signal:u},e)=>{const O=Te(e);await r.fetchTasks(O,{signal:u})});P(()=>g.query,u=>{o.value=J(u),f.run(o.value)},{immediate:!0});const S=me,Z=H,X=ye;function Y(){return p()}function Q(){return p()}function F(){return p()}function V(){return p()}function ee(){return p()}function te(){return v("statuses")}function se(){return v("priorities")}P(()=>o.value.tags,()=>p(),{deep:!0});const re=be(()=>p(),350);function ae(u){o.value.search=u.target.value,re()}function z(u){if(!(u<1||u>r.totalPages))return o.value.pageNumber=u,C({usePush:!0})}function oe(){return z(r.pageNumber-1)}function ne(){return z(r.pageNumber+1)}const ie=w(()=>r.isLoading&&!r.hasLoadedOnce),E=w(()=>r.isLoading&&r.hasLoadedOnce);return(u,e)=>{const O=ge("router-link");return i(),n("section",De,[s("header",Be,[e[10]||(e[10]=s("div",{class:"space-y-2"},[s("h1",{class:"text-3xl font-semibold tracking-tight"},"Tasks"),s("p",{class:"text-gray-600"},"Filter, search, sort, and page through your tasks.")],-1)),k(O,{to:{name:l(L).TASKS_NEW},class:"inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700"},{default:D(()=>[...e[9]||(e[9]=[m(" New Task ",-1)])]),_:1},8,["to"])]),s("div",Pe,[s("div",Ie,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-gray-700"},"Search",-1)),s("input",{value:o.value.search,onInput:ae,type:"text",placeholder:"Search title, tags…",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},null,40,Re)]),s("div",Fe,[s("div",{class:"flex items-center justify-between"},[e[13]||(e[13]=s("label",{class:"block text-sm font-medium text-gray-700"},"Statuses",-1)),s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:te,"aria-label":"Clear statuses",title:"Clear statuses"},[...e[12]||(e[12]=[m(" ✕ ",-1),s("span",null,"Clear",-1)])])]),s("div",Ve,[(i(!0),n(y,null,b(l(G),a=>(i(),n("label",{key:a,class:"flex items-center gap-2 text-sm text-gray-700"},[x(s("input",{type:"checkbox",class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500","onUpdate:modelValue":e[0]||(e[0]=_=>o.value.statuses=_),value:a,onChange:Y},null,40,ze),[[M,o.value.statuses]]),s("span",null,d(a),1)]))),128))]),e[14]||(e[14]=s("div",{class:"mt-1 text-xs text-gray-500"},"Choose any; empty means all.",-1))]),s("div",Ee,[s("div",{class:"flex items-center justify-between"},[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-gray-700"},"Priorities",-1)),s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:se,"aria-label":"Clear priorities",title:"Clear priorities"},[...e[15]||(e[15]=[m(" ✕ ",-1),s("span",null,"Clear",-1)])])]),s("div",Ue,[(i(!0),n(y,null,b(l(pe),a=>(i(),n("label",{key:a,class:"flex items-center gap-2 text-sm text-gray-700"},[x(s("input",{type:"checkbox",class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500","onUpdate:modelValue":e[1]||(e[1]=_=>o.value.priorities=_),value:a,onChange:Q},null,40,qe),[[M,o.value.priorities]]),s("span",null,d(a),1)]))),128))]),e[17]||(e[17]=s("div",{class:"mt-1 text-xs text-gray-500"},"Choose any; empty means all.",-1))]),s("div",Le,[e[18]||(e[18]=s("label",{class:"block text-sm font-medium text-gray-700"},"Due on or after",-1)),x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.dueOnOrAfter=a),type:"date",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",onChange:F},null,544),[[q,o.value.dueOnOrAfter]])]),s("div",Me,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700"},"Due on or before",-1)),x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.dueOnOrBefore=a),type:"date",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",onChange:F},null,544),[[q,o.value.dueOnOrBefore]])]),s("div",$e,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-gray-700"},"Tags",-1)),s("div",je,[k(ve,{modelValue:o.value.tags,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.tags=a),limit:10,"show-clear-button":!0,"clear-button-label":"Clear"},null,8,["modelValue"])])]),s("div",Ke,[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700"},"Sort by",-1)),x(s("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.sortBy=a),class:"mt-1 w-full rounded-md border border-gray-300 pl-3 pr-8 py-2 text-sm",onChange:V},[(i(!0),n(y,null,b(l(S),a=>(i(),n("option",{key:a.value,value:a.value},d(a.label),9,Je))),128))],544),[[N,o.value.sortBy]])]),s("div",We,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700"},"Direction",-1)),x(s("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.sortDirection=a),class:"mt-1 w-full rounded-md border border-gray-300 pl-3 pr-8 py-2 text-sm",onChange:V},[(i(!0),n(y,null,b(l(Z),a=>(i(),n("option",{key:a,value:a},d(a),9,Ge))),128))],544),[[N,o.value.sortDirection]])]),s("div",He,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700"},"Page size",-1)),x(s("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.pageSize=a),class:"mt-1 w-full rounded-md border border-gray-300 pl-3 pr-8 py-2 text-sm",onChange:ee},[(i(!0),n(y,null,b(l(X),a=>(i(),n("option",{key:a,value:a},d(a),9,Ze))),128))],544),[[N,o.value.pageSize,void 0,{number:!0}]])])]),k(fe,{show:!!l(r).errorMessage,title:"Could not load tasks",message:l(r).errorMessage,"correlation-id":l(r).errorCorrelationId,variant:"error",onClose:e[8]||(e[8]=a=>l(r).errorMessage="")},null,8,["show","message","correlation-id"]),ie.value?(i(),n("div",Xe,[e[24]||(e[24]=s("div",{class:"h-4 w-1/3 animate-pulse rounded bg-gray-200"},null,-1)),s("div",Ye,[(i(),n(y,null,b(6,a=>s("div",{key:a,class:"h-10 animate-pulse rounded bg-gray-100"})),64))])])):(i(),n(y,{key:1},[E.value?(i(),n("div",Qe)):I("",!0),!l(r).hasTasks&&!l(r).errorMessage?(i(),n("div",et,[o.value.search||o.value.statuses.length||o.value.priorities.length||o.value.tags.length||o.value.dueOnOrAfter||o.value.dueOnOrBefore?(i(),n("div",tt," No results match your filters. ")):(i(),n("div",st,[e[26]||(e[26]=m(" No tasks yet. ",-1)),k(O,{to:{name:l(L).TASKS_NEW},class:"text-indigo-700 underline"},{default:D(()=>[...e[25]||(e[25]=[m(" Create one ",-1)])]),_:1},8,["to"]),e[27]||(e[27]=m(" or remove filters. ",-1))]))])):(i(),n("div",{key:2,class:"overflow-hidden rounded-lg border border-gray-200 bg-white","aria-busy":E.value?"true":"false"},[e[28]||(e[28]=de('<div class="hidden grid-cols-12 gap-2 border-b bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 md:grid"><div class="col-span-5">Title</div><div class="col-span-2">Priority</div><div class="col-span-2">Status</div><div class="col-span-2">Due</div><div class="col-span-1">Tags</div></div>',1)),s("ul",at,[(i(!0),n(y,null,b(l(r).tasks,a=>(i(),n("li",{key:a.id,class:"grid grid-cols-1 gap-2 px-4 py-3 md:grid-cols-12"},[s("div",ot,[k(O,{to:`/tasks/${encodeURIComponent(a.id)}`,class:"font-medium text-indigo-700 hover:underline"},{default:D(()=>[m(d(a.title),1)]),_:2},1032,["to"])]),s("div",nt,[s("span",it,d(a.priority||"—"),1)]),s("div",lt,[k(Ne,{"task-id":a.id,status:a.status},null,8,["task-id","status"])]),s("div",ut,d(a.dueDate?new Date(a.dueDate).toLocaleDateString():"—"),1),s("div",dt,[(i(!0),n(y,null,b(a.tags,_=>(i(),n("span",{key:_,class:"rounded bg-indigo-50 px-1.5 py-0.5 text-[11px] text-indigo-700"},d(_),1))),128))])]))),128))])],8,rt)),s("div",gt,[s("div",ct,[s("span",pt,d(l(r).totalCount),1),e[29]||(e[29]=m(" results ",-1))]),s("div",mt,[s("button",{class:"rounded-md border border-gray-300 px-2 py-1 text-sm disabled:opacity-50",disabled:l(r).pageNumber<=1,onClick:oe}," Prev ",8,yt),s("span",bt,[e[30]||(e[30]=m(" Page ",-1)),s("strong",null,d(l(r).pageNumber),1),e[31]||(e[31]=m(" of ",-1)),s("strong",null,d(l(r).totalPages),1)]),s("button",{class:"rounded-md border border-gray-300 px-2 py-1 text-sm disabled:opacity-50",disabled:l(r).pageNumber>=l(r).totalPages,onClick:ne}," Next ",8,vt)])])],64))])}}};export{Ot as default};
