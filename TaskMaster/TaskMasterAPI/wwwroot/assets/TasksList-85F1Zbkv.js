import{q as re,i as ae,g as oe,l as D,c as B,a as n,b as s,d as h,w as O,f as l,h as g,F as y,s as x,n as v,v as R,x as N,m as ne,y as ie,t as u,r as le,k as ue,o as i,R as I,z as V,A as de}from"./index-CaANifo-.js";import{D as m,S as L,T as q,d as ge,_ as pe,a as ce,b as me,c as be,P as ye,m as fe}from"./tasks-BO7GUg6L.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function S(t){return t==null?[]:Array.isArray(t)?t:[t]}function z(t,a){const p=Number(t);return Number.isFinite(p)&&p>0?p:a}function E(t,a,p){return!t||typeof t!="string"?p:a.includes(t)?t:p}function F(t){return typeof t!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(t)?"":t}function U(t){return{pageNumber:z(t.pageNumber,m.pageNumber),pageSize:z(t.pageSize,m.pageSize),statuses:S(t.statuses),priorities:S(t.priorities),tags:S(t.tags),dueOnOrAfter:F(t.dueOnOrAfter),dueOnOrBefore:F(t.dueOnOrBefore),search:typeof t.search=="string"?t.search:"",sortBy:E(t.sortBy,q,"dueDate"),sortDirection:E(t.sortDirection,L,"asc")}}function xe(t){const a={pageNumber:String(t.pageNumber),pageSize:String(t.pageSize),sortBy:t.sortBy,sortDirection:t.sortDirection};return t.search&&(a.search=t.search),t.dueOnOrAfter&&(a.dueOnOrAfter=t.dueOnOrAfter),t.dueOnOrBefore&&(a.dueOnOrBefore=t.dueOnOrBefore),Array.isArray(t.statuses)&&t.statuses.length>0&&(a.statuses=t.statuses),Array.isArray(t.priorities)&&t.priorities.length>0&&(a.priorities=t.priorities),Array.isArray(t.tags)&&t.tags.length>0&&(a.tags=t.tags),a}function ve(t){const a={pageNumber:t.pageNumber,pageSize:t.pageSize,includeTags:!0,sortBy:t.sortBy,sortDirection:t.sortDirection};return t.search&&(a.search=t.search),t.dueOnOrAfter&&(a.dueOnOrAfter=t.dueOnOrAfter),t.dueOnOrBefore&&(a.dueOnOrBefore=t.dueOnOrBefore),t.statuses?.length&&(a.statuses=t.statuses),t.priorities?.length&&(a.priorities=t.priorities),t.tags?.length&&(a.tags=t.tags),a}const he={class:"mx-auto max-w-6xl p-6 space-y-6"},Oe={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ne={class:"grid gap-3 rounded-lg border border-gray-200 bg-white p-4 shadow-sm md:grid-cols-3 lg:grid-cols-4"},Se={class:"md:col-span-1 lg:col-span-2"},_e=["value"],ke={class:"md:col-span-1"},Ce={class:"mt-2 space-y-2"},Ae=["value"],we={class:"md:col-span-1"},Te={class:"mt-2 space-y-2"},Pe=["value"],De={class:"md:col-span-1"},Be={class:"md:col-span-1"},Re={class:"md:col-span-3 lg:col-span-4"},Ie={class:"mt-1"},Ve={class:"md:col-span-1"},ze=["value"],Ee={class:"md:col-span-1"},Fe=["value"],Ue={class:"md:col-span-1"},Le=["value"],qe={key:0,class:"space-y-3 rounded-lg border border-gray-200 bg-white p-4"},Me={class:"space-y-2"},je={key:0,class:"h-1 w-full animate-pulse rounded bg-indigo-200"},Ke={key:1,class:"rounded-lg border border-gray-200 bg-white p-8 text-center text-gray-600"},Je={key:0},$e={key:1},We=["aria-busy"],Ge={class:"divide-y"},Ze={class:"col-span-5"},He={class:"col-span-2"},Xe={class:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-700"},Ye={class:"col-span-2"},Qe={class:"col-span-2 text-sm text-gray-700"},es={class:"col-span-1 flex flex-wrap items-center gap-1"},ss={class:"mt-4 flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between"},ts={class:"text-sm text-gray-600"},rs={class:"font-medium"},as={class:"flex items-center gap-3"},os=["disabled"],ns={class:"px-2 text-sm text-gray-700"},is=["disabled"],gs={__name:"TasksList",setup(t){const a=re(),p=oe(),_=ue(),o=ae(U(p.query));function k(d){const e=JSON.parse(JSON.stringify(d??{}));return Array.isArray(e.statuses)&&(e.statuses=[...e.statuses].sort()),Array.isArray(e.priorities)&&(e.priorities=[...e.priorities].sort()),Array.isArray(e.tags)&&(e.tags=[...e.tags].sort()),e}function M(d,e){const b=k(d),r=k(e),f=JSON.stringify(b),te=JSON.stringify(r);return f===te}async function c({usePush:d=!1}={}){o.value.pageNumber<1&&(o.value.pageNumber=1);const e=xe(o.value),b=p.query;M(e,b)||(d?await _.push({query:e}):await _.replace({query:e}))}const j=fe(async({signal:d},e)=>{const b=ve(e);await a.fetchTasks(b,{signal:d})});D(()=>p.query,d=>{o.value=U(d),j.run(o.value)},{immediate:!0});const K=q,J=L,$=ye;D(()=>o.value.tags,()=>{o.value.pageNumber=m.pageNumber,c({usePush:!1})},{deep:!0});function C(){o.value.pageNumber=m.pageNumber,c({usePush:!1})}function A(){o.value.pageNumber=m.pageNumber,c({usePush:!1})}function W(){o.value.statuses=[],C()}function G(){o.value.priorities=[],A()}function Z(){o.value.tags=[],o.value.pageNumber=m.pageNumber,c({usePush:!1})}function w(){o.value.pageNumber=m.pageNumber,c({usePush:!1})}function T(){o.value.pageNumber=m.pageNumber,c({usePush:!1})}function H(){o.value.pageNumber=m.pageNumber,c({usePush:!1})}const X=ge(()=>{o.value.pageNumber=m.pageNumber,c({usePush:!1})},350);function Y(d){o.value.search=d.target.value,X()}function Q(){a.pageNumber>1&&(o.value.pageNumber=a.pageNumber-1,c({usePush:!0}))}function ee(){a.pageNumber<a.totalPages&&(o.value.pageNumber=a.pageNumber+1,c({usePush:!0}))}const se=B(()=>a.isLoading&&!a.hasLoadedOnce),P=B(()=>a.isLoading&&a.hasLoadedOnce);return(d,e)=>{const b=le("router-link");return i(),n("section",he,[s("header",Oe,[e[10]||(e[10]=s("div",{class:"space-y-2"},[s("h1",{class:"text-3xl font-semibold tracking-tight"},"Tasks"),s("p",{class:"text-gray-600"},"Filter, search, sort, and page through your tasks.")],-1)),h(b,{to:{name:l(I).TASKS_NEW},class:"inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700"},{default:O(()=>[...e[9]||(e[9]=[g(" New Task ",-1)])]),_:1},8,["to"])]),s("div",Ne,[s("div",Se,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-gray-700"},"Search",-1)),s("input",{value:o.value.search,onInput:Y,type:"text",placeholder:"Search title, tags…",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"},null,40,_e)]),s("div",ke,[s("div",{class:"flex items-center justify-between"},[e[13]||(e[13]=s("label",{class:"block text-sm font-medium text-gray-700"},"Statuses",-1)),s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:W,"aria-label":"Clear statuses",title:"Clear statuses"},[...e[12]||(e[12]=[g(" ✕ ",-1),s("span",null,"Clear",-1)])])]),s("div",Ce,[(i(!0),n(y,null,x(l(me),r=>(i(),n("label",{key:r,class:"flex items-center gap-2 text-sm text-gray-700"},[v(s("input",{type:"checkbox",class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500","onUpdate:modelValue":e[0]||(e[0]=f=>o.value.statuses=f),value:r,onChange:C},null,40,Ae),[[V,o.value.statuses]]),s("span",null,u(r),1)]))),128))]),e[14]||(e[14]=s("div",{class:"mt-1 text-xs text-gray-500"},"Choose any; empty means all.",-1))]),s("div",we,[s("div",{class:"flex items-center justify-between"},[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-gray-700"},"Priorities",-1)),s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:G,"aria-label":"Clear priorities",title:"Clear priorities"},[...e[15]||(e[15]=[g(" ✕ ",-1),s("span",null,"Clear",-1)])])]),s("div",Te,[(i(!0),n(y,null,x(l(be),r=>(i(),n("label",{key:r,class:"flex items-center gap-2 text-sm text-gray-700"},[v(s("input",{type:"checkbox",class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500","onUpdate:modelValue":e[1]||(e[1]=f=>o.value.priorities=f),value:r,onChange:A},null,40,Pe),[[V,o.value.priorities]]),s("span",null,u(r),1)]))),128))]),e[17]||(e[17]=s("div",{class:"mt-1 text-xs text-gray-500"},"Choose any; empty means all.",-1))]),s("div",De,[e[18]||(e[18]=s("label",{class:"block text-sm font-medium text-gray-700"},"Due on or after",-1)),v(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.dueOnOrAfter=r),type:"date",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",onChange:w},null,544),[[R,o.value.dueOnOrAfter]])]),s("div",Be,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-gray-700"},"Due on or before",-1)),v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.dueOnOrBefore=r),type:"date",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500",onChange:w},null,544),[[R,o.value.dueOnOrBefore]])]),s("div",Re,[s("div",{class:"flex items-center justify-between"},[e[21]||(e[21]=s("label",{class:"block text-sm font-medium text-gray-700"},"Tags",-1)),s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",onClick:Z,"aria-label":"Clear tags",title:"Clear tags"},[...e[20]||(e[20]=[g(" ✕ ",-1),s("span",null,"Clear",-1)])])]),s("div",Ie,[h(pe,{modelValue:o.value.tags,"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.tags=r),limit:10},null,8,["modelValue"])])]),s("div",Ve,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700"},"Sort by",-1)),v(s("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.value.sortBy=r),class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm",onChange:T},[(i(!0),n(y,null,x(l(K),r=>(i(),n("option",{key:r,value:r},u(r),9,ze))),128))],544),[[N,o.value.sortBy]])]),s("div",Ee,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700"},"Direction",-1)),v(s("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.value.sortDirection=r),class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm",onChange:T},[(i(!0),n(y,null,x(l(J),r=>(i(),n("option",{key:r,value:r},u(r),9,Fe))),128))],544),[[N,o.value.sortDirection]])]),s("div",Ue,[e[24]||(e[24]=s("label",{class:"block text-sm font-medium text-gray-700"},"Page size",-1)),v(s("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.value.pageSize=r),class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm",onChange:H},[(i(!0),n(y,null,x(l($),r=>(i(),n("option",{key:r,value:r},u(r),9,Le))),128))],544),[[N,o.value.pageSize,void 0,{number:!0}]])])]),h(ce,{show:!!l(a).errorMessage,title:"Could not load tasks",message:l(a).errorMessage,"correlation-id":l(a).errorCorrelationId,variant:"error",onClose:e[8]||(e[8]=r=>l(a).errorMessage="")},null,8,["show","message","correlation-id"]),se.value?(i(),n("div",qe,[e[25]||(e[25]=s("div",{class:"h-4 w-1/3 animate-pulse rounded bg-gray-200"},null,-1)),s("div",Me,[(i(),n(y,null,x(6,r=>s("div",{key:r,class:"h-10 animate-pulse rounded bg-gray-100"})),64))])])):(i(),n(y,{key:1},[P.value?(i(),n("div",je)):ne("",!0),!l(a).hasTasks&&!l(a).errorMessage?(i(),n("div",Ke,[o.value.search||o.value.statuses.length||o.value.priorities.length||o.value.tags.length||o.value.dueOnOrAfter||o.value.dueOnOrBefore?(i(),n("div",Je," No results match your filters. ")):(i(),n("div",$e,[e[27]||(e[27]=g(" No tasks yet. ",-1)),h(b,{to:{name:l(I).TASKS_NEW},class:"text-indigo-700 underline"},{default:O(()=>[...e[26]||(e[26]=[g(" Create one ",-1)])]),_:1},8,["to"]),e[28]||(e[28]=g(" or remove filters. ",-1))]))])):(i(),n("div",{key:2,class:"overflow-hidden rounded-lg border border-gray-200 bg-white","aria-busy":P.value?"true":"false"},[e[29]||(e[29]=ie('<div class="hidden grid-cols-12 gap-2 border-b bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 md:grid"><div class="col-span-5">Title</div><div class="col-span-2">Priority</div><div class="col-span-2">Status</div><div class="col-span-2">Due</div><div class="col-span-1">Tags</div></div>',1)),s("ul",Ge,[(i(!0),n(y,null,x(l(a).tasks,r=>(i(),n("li",{key:r.id,class:"grid grid-cols-1 gap-2 px-4 py-3 md:grid-cols-12"},[s("div",Ze,[h(b,{to:`/tasks/${encodeURIComponent(r.id)}`,class:"font-medium text-indigo-700 hover:underline"},{default:O(()=>[g(u(r.title),1)]),_:2},1032,["to"])]),s("div",He,[s("span",Xe,u(r.priority||"—"),1)]),s("div",Ye,[s("span",{class:de(["rounded-full px-2 py-0.5 text-xs",r.isCompleted?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},u(r.status),3)]),s("div",Qe,u(r.dueDate?new Date(r.dueDate).toLocaleDateString():"—"),1),s("div",es,[(i(!0),n(y,null,x(r.tags,f=>(i(),n("span",{key:f,class:"rounded bg-indigo-50 px-1.5 py-0.5 text-[11px] text-indigo-700"},u(f),1))),128))])]))),128))])],8,We)),s("div",ss,[s("div",ts,[s("span",rs,u(l(a).totalCount),1),e[30]||(e[30]=g(" results ",-1))]),s("div",as,[s("button",{class:"rounded-md border border-gray-300 px-2 py-1 text-sm disabled:opacity-50",disabled:l(a).pageNumber<=1,onClick:Q}," Prev ",8,os),s("span",ns,[e[31]||(e[31]=g(" Page ",-1)),s("strong",null,u(l(a).pageNumber),1),e[32]||(e[32]=g(" of ",-1)),s("strong",null,u(l(a).totalPages),1)]),s("button",{class:"rounded-md border border-gray-300 px-2 py-1 text-sm disabled:opacity-50",disabled:l(a).pageNumber>=l(a).totalPages,onClick:ee}," Next ",8,is)])])],64))])}}};export{gs as default};
