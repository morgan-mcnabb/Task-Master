import{E as ue,n as ce,k as ve,r as i,B as C,p as ge,o as pe,c,b as t,h as E,z as me,g as T,t as f,i as X,j as S,f as fe,q as G,F as Q,x as W,e as A,d as M,v as F,s as ye,l as be,a as xe,R as $,G as K,H as Y,m as v,T as he}from"./index-CTgWvdHK.js";import{u as ke,T as Z,_ as Te}from"./TagPicker-Bqnf6D6L.js";import{b as Se,c as we}from"./statusStyles-Cs-sMj5i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"mx-auto max-w-3xl p-6 space-y-6"},De={key:0,class:"rounded-lg border border-gray-200 bg-white p-5"},Ie={key:1,class:"rounded-md border border-red-200 bg-red-50 px-4 py-3 text-red-700"},Ce={class:"mt-3"},Ee={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Re={class:"text-sm text-gray-600"},Ve={class:"rounded bg-gray-50 px-1 py-0.5"},Ae={class:"inline-flex items-center gap-2"},Me={class:"space-y-2"},$e={class:"flex flex-wrap gap-2",role:"radiogroup","aria-label":"Task status"},Ue=["aria-pressed","disabled","onClick"],Ne={class:"inline-flex items-center gap-2"},Be={key:0,"aria-hidden":"true",class:"text-xs opacity-80"},Fe=["disabled"],Ke={key:0,class:"mt-1 text-sm text-red-600"},Oe=["disabled"],je={key:0,class:"mt-1 text-sm text-red-600"},Le={class:"grid gap-4 md:grid-cols-2"},qe=["disabled"],ze=["value"],Pe=["disabled"],He={key:0,class:"mt-1 text-sm text-red-600"},Je={class:"flex flex-wrap items-center gap-3"},Xe=["disabled"],Ge=["disabled"],Qe=["disabled"],ee=120,te=2e3,st={__name:"TaskDetails",setup(We){const se=ve(),O=xe(),h=ke(),R=ue(),_=ce(),d=String(se.params.id||"").trim(),U=i(!1),n=i(!1),r=i(!1),D=i(""),p=i(""),m=i(""),y=i(C.includes("Medium")?"Medium":C[0]),k=i(""),g=i([]),I=i("Todo"),b=i("Todo");let x={title:"",description:"",priority:y.value,dueDate:"",tags:[],status:"Todo"};const N=i({show:!1,message:""}),w=i({show:!1,message:"",correlationId:""});function V(s){const e=h.correlationId||"";w.value={show:!0,message:s,correlationId:e}}function ae(){x={title:p.value,description:m.value,priority:y.value,dueDate:k.value||"",tags:[...g.value],status:I.value}}function j(s){p.value=String(s?.title||""),m.value=String(s?.description||""),y.value=String(s?.priority||(C.includes("Medium")?"Medium":C[0])),k.value=s?.dueDate?String(s.dueDate):"",g.value=K(Y(s?.tags||[])),I.value=String(s?.status||"Todo"),b.value=I.value,ae()}const L=ge(()=>{const s={title:p.value,description:m.value,priority:y.value,dueDate:k.value||"",tags:[...g.value],status:b.value};return JSON.stringify(s)!==JSON.stringify(x)});function q(){const s=R.getETag(d);return h.withIfMatch({},s)}async function z(s){try{await P(),V(`${s} The task was updated elsewhere; the latest version has been loaded. Re-apply your changes and try again.`)}catch{V(`${s} Additionally, failed to reload the latest task state.`)}}async function P(){if(!d){D.value="Invalid task id.";return}U.value=!0,D.value="";try{const{data:s,response:e}=await h.get(`/api/v1/tasks/${encodeURIComponent(d)}`);j(s);const l=s?.eTag||h.readETag(e);l&&R.setETag(d,l)}catch(s){D.value=s?.message||"Failed to load task."}finally{U.value=!1}}const u=i({title:"",description:"",tags:""});function le(){u.value={title:"",description:"",tags:""};const s=p.value.trim();return s?s.length>ee&&(u.value.title=`Title must be at most ${ee} characters.`):u.value.title="Title is required.",(m.value||"").trim().length>te&&(u.value.description=`Description must be at most ${te} characters.`),g.value.length!==K(g.value).length&&(u.value.tags="Tags must be unique (case-insensitive)."),Object.values(u.value).every(l=>!l)}async function oe(){p.value=p.value.trim(),m.value=m.value.trim();const s=K(g.value);if(g.value=s,!le())return;n.value=!0,w.value={show:!1,message:"",correlationId:""};const e={id:d,title:p.value,description:m.value||void 0,priority:y.value,status:b.value,dueDate:k.value||null,tags:g.value};try{const l=q(),{data:a,response:H}=await h.put(`/api/v1/tasks/${encodeURIComponent(d)}`,e,{headers:l});j(a);const J=a?.eTag||h.readETag(H);J&&R.setETag(d,J);try{const B=_.tasks.findIndex(o=>String(o.id)===d);if(B>=0){const o={..._.tasks[B]};o.title=a?.title??o.title,o.priority=a?.priority??o.priority,o.status=a?.status??o.status,o.isCompleted=String(o.status).toLowerCase()==="done",o.dueDate=a?.dueDate??o.dueDate??null,o.tags=Y(a?.tags??o.tags??[]),_.tasks.splice(B,1,o)}}catch{}await O.replace({name:$.TASKS})}catch(l){if(l?.status===412){await z("Save was rejected due to an outdated version.");return}V(l?.message||"Failed to save task.")}finally{n.value=!1}}function ie(s){!s||n.value||r.value||(b.value=s)}async function ne(){if(window.confirm("Delete this task? This cannot be undone.")){r.value=!0;try{const e=q();await h.delete(`/api/v1/tasks/${encodeURIComponent(d)}`,{headers:e});try{R.clearETag(d)}catch{}try{const l=_.tasks.findIndex(a=>String(a.id)===d);l>=0&&_.tasks.splice(l,1)}catch{}O.replace({name:$.TASKS})}catch(e){if(e?.status===412){await z("Delete was rejected due to an outdated version.");return}V(e?.message||"Failed to delete task.")}finally{r.value=!1}}}function re(){p.value=x.title,m.value=x.description,y.value=x.priority,k.value=x.dueDate,g.value=[...x.tags],b.value=x.status}function de(s){return String(s)}return pe(()=>{P()}),(s,e)=>{const l=be("router-link");return v(),c("section",_e,[e[20]||(e[20]=t("header",{class:"space-y-1"},[t("h1",{class:"text-2xl font-semibold"},"Task Details"),t("p",{class:"text-gray-600"},"View and edit task details. Changes use ETags for concurrency safety.")],-1)),E(Z,{show:N.value.show,title:"Success",message:N.value.message,variant:"success",onClose:e[0]||(e[0]=a=>N.value.show=!1)},null,8,["show","message"]),E(Z,{show:w.value.show,title:"Something went wrong",message:w.value.message,"correlation-id":w.value.correlationId,variant:"error",onClose:e[1]||(e[1]=a=>w.value.show=!1)},null,8,["show","message","correlation-id"]),U.value?(v(),c("div",De,[...e[7]||(e[7]=[me('<div class="h-4 w-1/3 animate-pulse rounded bg-gray-200"></div><div class="mt-3 space-y-2"><div class="h-10 animate-pulse rounded bg-gray-100"></div><div class="h-24 animate-pulse rounded bg-gray-100"></div><div class="grid gap-3 md:grid-cols-2"><div class="h-10 animate-pulse rounded bg-gray-100"></div><div class="h-10 animate-pulse rounded bg-gray-100"></div></div><div class="h-10 animate-pulse rounded bg-gray-100"></div></div>',2)])])):D.value?(v(),c("div",Ie,[T(f(D.value)+" ",1),t("div",Ce,[E(l,{to:{name:S($).TASKS},class:"text-sm underline"},{default:X(()=>[...e[8]||(e[8]=[T("Back to list",-1)])]),_:1},8,["to"])])])):(v(),c("form",{key:2,class:"space-y-6 rounded-lg border border-gray-200 bg-white p-5 shadow-sm",onSubmit:fe(oe,["prevent"])},[t("div",Ee,[t("div",Re,[e[9]||(e[9]=T(" Task ID: ",-1)),t("code",Ve,f(S(d)),1)]),t("div",Ae,[e[10]||(e[10]=t("span",{class:"text-sm text-gray-600"},"Current status:",-1)),t("span",{class:G(["rounded-full px-2 py-0.5 text-xs",S(Se)(I.value)])},f(I.value),3)])]),t("div",Me,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Set status",-1)),t("div",$e,[(v(!0),c(Q,null,W(S(he),a=>(v(),c("button",{key:a,type:"button",class:G(S(we)(a,b.value===a)),"aria-pressed":b.value===a?"true":"false",disabled:n.value||r.value,onClick:H=>ie(a)},[t("span",Ne,[t("span",null,f(de(a)),1),b.value===a?(v(),c("span",Be," ✓ ")):M("",!0)])],10,Ue))),128))]),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500"},[T(" Selecting a status does not save immediately. Click "),t("strong",null,"Save changes"),T(" to persist. ")],-1))]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},[T("Title "),t("span",{class:"text-red-600"},"*")],-1)),A(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),type:"text",maxlength:"120",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",disabled:n.value||r.value},null,8,Fe),[[F,p.value]]),u.value.title?(v(),c("p",Ke,f(u.value.title),1)):M("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Description",-1)),A(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>m.value=a),rows:"4",maxlength:"2000",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",disabled:n.value||r.value},null,8,Oe),[[F,m.value]]),u.value.description?(v(),c("p",je,f(u.value.description),1)):M("",!0)]),t("div",Le,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),A(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a),class:"mt-1 w-full rounded-md border border-gray-300 pl-3 pr-8 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",disabled:n.value||r.value},[(v(!0),c(Q,null,W(S(C),a=>(v(),c("option",{key:a,value:a},f(a),9,ze))),128))],8,qe),[[ye,y.value]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Due date",-1)),A(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),type:"date",class:"mt-1 w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",disabled:n.value||r.value},null,8,Pe),[[F,k.value]])])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tags",-1)),E(Te,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),limit:10,disabled:n.value||r.value},null,8,["modelValue","disabled"]),u.value.tags?(v(),c("p",He,f(u.value.tags),1)):M("",!0)]),t("div",Je,[t("button",{type:"submit",class:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-50",disabled:n.value||r.value||!L.value},f(n.value?"Saving…":"Save changes"),9,Xe),t("button",{type:"button",class:"rounded-md border border-gray-300 px-4 py-2 hover:bg-gray-50 disabled:opacity-50",disabled:n.value||r.value||!L.value,onClick:re}," Reset ",8,Ge),e[19]||(e[19]=t("div",{class:"flex-1"},null,-1)),E(l,{to:{name:S($).TASKS},class:"text-sm text-gray-700 underline"},{default:X(()=>[...e[18]||(e[18]=[T(" Back to list ",-1)])]),_:1},8,["to"]),t("button",{type:"button",class:"rounded-md border border-red-300 px-4 py-2 text-red-700 hover:bg-red-50 disabled:opacity-50",disabled:n.value||r.value,onClick:ne},f(r.value?"Deleting…":"Delete"),9,Qe)])],32))])}}};export{st as default};
